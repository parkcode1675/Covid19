<html>
    <head>
        <title>Corona</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
        <script src="https://www.gstatic.com/charts/loader.js" type="text/javascript"></script>
        <script src="ajax.js"></script>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        

        <script>
            window.onload = function(){
                ajaxCaller("https://api.covid19api.com/summary",function(data){
                    //console.log("window.onload : " + JSON.stringify(data));

                    var dataCountry = data.Countries;
                    var dataTotal = data.Global;

                    dataCountry.sort(function(a,b){
                        return b.TotalConfirmed - a.TotalConfirmed;
                    });

                    setTotal(dataTotal);
                    setMap(dataCountry);
                    setTable(dataCountry);
                });

            }

            google.charts.load('current', {
                'packages':['geochart'],
            });

            function setTotal(data){
                //console.log(data);

                $("#NewConfirmed").empty();
                $("#TotalConfirmed").empty();
                $("#NewDeaths").empty();
                $("#TotalDeaths").empty();
                $("#Date").empty();

                $("#NewConfirmed").append(data.NewConfirmed.toLocaleString('ko-KR'));
                $("#TotalConfirmed").append(data.TotalConfirmed.toLocaleString('ko-KR'));
                $("#NewDeaths").append(data.NewDeaths.toLocaleString('ko-KR'));
                $("#TotalDeaths").append(data.TotalDeaths.toLocaleString('ko-KR'));
                $("#Date").append("Data Date : " + data.Date);
            }

            function setMap(data){

                console.log(data);

                var mapData = data;
                var array = [];

                array.push(['Country','TotalConfirmed','TotalDeaths']);
                //array.push(['Country','TotalConfirmed']);

                console.log(data.length);

                for(var i=0;i<data.length;i++){
                    array.push([data[i].CountryCode,data[i].TotalConfirmed,data[i].TotalDeaths]);
                    //array.push(data[i].CountryCode,data[i].TotalConfirmed);
                }

                console.log(array);

                var mapChart = google.visualization.arrayToDataTable(array);

                var option = {colorAxis: {colors:['#E69C9C','red']}};

                var geoChart = new google.visualization.GeoChart(document.getElementById('map'));

                geoChart.draw(mapChart,option);
            }

            function setTable(data){
                var tableData = data;
                var tableHtml = "";

                //console.log("setTable : " + data.length);

                $("#mainTable").empty();

                for(var i=0;i<data.length;i++){
                    tableHtml += '<tr>';
                    tableHtml += '<td>' + data[i].Country.toLocaleString('ko-KR') + '</td>';
                    tableHtml += '<td>' + data[i].TotalConfirmed.toLocaleString('ko-KR') + '</td>';
                    tableHtml += '<td>' + data[i].TotalDeaths.toLocaleString('ko-KR') + '</td>';
                    tableHtml += '</tr>';  
                }

                $("#mainTable").append(tableHtml);
            }
        </script>
    </head>
    <body>
        <div class="container">
            <div class="row text-center" style="margin-top: 30px;"> <!--main-->
                <h1>Covid-19</h2>
            </div>
            <div class="row text-center"> <!--main-->
                <h5 id="Date"></h2>
            </div>
            <div class="row text-center" style="margin-top: 30px;"> <!--Total-->
                <div class="col-md-3">
                    <h4>NewConfirmed</h4>
                </div>
                <div class="col-md-3">
                    <h4>TotalConfirmed</h4>
                </div>
                <div class="col-md-3">
                    <h4>NewDeaths</h4>
                </div>
                <div class="col-md-3">
                    <h4>TotalDeaths</h4>
                </div>
            </div>
            <div class="row text-center"> 
                <div class="col-md-3">
                    <h4 id="NewConfirmed"></h4>
                </div>
                <div class="col-md-3">
                    <h4 id="TotalConfirmed"></h4>
                </div>
                <div class="col-md-3">
                    <h4 id="NewDeaths"></h4>
                </div>
                <div class="col-md-3">
                    <h4 id="TotalDeaths"></h4>
                </div>
            </div>
            <div class="row" id="map" style="margin-top: 30px;"> <!--map-->

            </div>
            <div class="row" style="margin-top: 30px;"> <!--table-->
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Conutry</th>
                            <th scope="col">Confirmed</th>
                            <th scope="col">Deaths</th>
                        </tr>
                    </thead>
                    <tbody id="mainTable">

                    </tbody>
                </table>
            </div>
        </div>
    </body>
</html>